% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math} % this also loads fontspec
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else
  % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\usepackage{graphicx}
\usepackage{booktabs}
\usepackage{longtable}
\usepackage{array}
\usepackage{multirow}
\usepackage{wrapfig}
\usepackage{float}
\usepackage{colortbl}
\usepackage{pdflscape}
\usepackage{tabu}
\usepackage{threeparttable}
\usepackage{threeparttablex}
\usepackage[normalem]{ulem}
\usepackage{makecell}
\usepackage{xcolor}
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage{bookmark}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same}
\hypersetup{
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\author{}
\date{\vspace{-2.5em}}

\begin{document}

\subsection{Census data}\label{census-data}

We load previously loaded census data. The code for fetching this data
is also shown in this section.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{load}\NormalTok{(}\FunctionTok{here}\NormalTok{(}\StringTok{"API\_KEY.rda"}\NormalTok{))}

\FunctionTok{options}\NormalTok{(}\AttributeTok{cancensus.api\_key =}\NormalTok{ api\_key)}
\FunctionTok{options}\NormalTok{(}\AttributeTok{cancensus.cache\_path =} \StringTok{"cache"}\NormalTok{)}

\NormalTok{vectors }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"v\_CA21\_1"}\NormalTok{, }\StringTok{"v\_CA21\_6"}\NormalTok{, }\StringTok{"v\_CA21\_452"}\NormalTok{, }\StringTok{"v\_CA21\_449"}\NormalTok{, }\StringTok{"v\_CA21\_1040"}\NormalTok{, }\StringTok{"v\_CA21\_1085"}\NormalTok{, }\StringTok{"v\_CA21\_905"}\NormalTok{)}

\NormalTok{region\_DA }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"59154012"}\NormalTok{, }\StringTok{"59154105"}\NormalTok{, }\StringTok{"59154090"}\NormalTok{, }\StringTok{"59150936"}\NormalTok{, }\StringTok{"59154101"}\NormalTok{, }\StringTok{"59154104"}\NormalTok{, }
               \StringTok{"59154035"}\NormalTok{, }\StringTok{"59154103"}\NormalTok{, }\StringTok{"59154102"}\NormalTok{, }\StringTok{"59154034"}\NormalTok{, }\StringTok{"59150945"}\NormalTok{, }\StringTok{"59154091"}\NormalTok{, }
               \StringTok{"59154093"}\NormalTok{, }\StringTok{"59154099"}\NormalTok{, }\StringTok{"59150946"}\NormalTok{, }\StringTok{"59154100"}\NormalTok{, }\StringTok{"59154078"}\NormalTok{, }\StringTok{"59154079"}\NormalTok{, }
               \StringTok{"59154082"}\NormalTok{, }\StringTok{"59154081"}\NormalTok{, }\StringTok{"59154080"}\NormalTok{, }\StringTok{"59150939"}\NormalTok{, }\StringTok{"59150938"}\NormalTok{, }\StringTok{"59154083"}\NormalTok{, }
               \StringTok{"59154095"}\NormalTok{, }\StringTok{"59154084"}\NormalTok{, }\StringTok{"59150941"}\NormalTok{, }\StringTok{"59150942"}\NormalTok{, }\StringTok{"59154085"}\NormalTok{, }\StringTok{"59154088"}\NormalTok{, }
               \StringTok{"59154087"}\NormalTok{, }\StringTok{"59154089"}\NormalTok{, }\StringTok{"59154097"}\NormalTok{, }\StringTok{"59154098"}\NormalTok{, }\StringTok{"59154096"}\NormalTok{, }\StringTok{"59154092"}\NormalTok{, }
               \StringTok{"59154013"}\NormalTok{, }\StringTok{"59150952"}\NormalTok{)}

\NormalTok{census\_data }\OtherTok{\textless{}{-}} \FunctionTok{get\_census}\NormalTok{(}
  \AttributeTok{dataset =} \StringTok{"CA21"}\NormalTok{,}
  \AttributeTok{regions =} \FunctionTok{list}\NormalTok{(}\AttributeTok{CSD =} \StringTok{"5915022"}\NormalTok{, }\AttributeTok{DA =}\NormalTok{ region\_DA),}
  \AttributeTok{vectors =}\NormalTok{ vectors,}
  \AttributeTok{labels =} \StringTok{"detailed"}\NormalTok{,}
  \AttributeTok{geo\_format =} \StringTok{"sf"}\NormalTok{,}
  \AttributeTok{level =} \StringTok{"DA"}
\NormalTok{)}

\NormalTok{census\_data }\OtherTok{\textless{}{-}}\NormalTok{ census\_data }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{pop\_density =} \StringTok{\textasciigrave{}}\AttributeTok{v\_CA21\_1: Population, 2021}\StringTok{\textasciigrave{}} \SpecialCharTok{/} \StringTok{\textasciigrave{}}\AttributeTok{Shape Area}\StringTok{\textasciigrave{}}\NormalTok{)}

\NormalTok{can\_api\_key }\OtherTok{\textless{}{-}} \StringTok{""}
\FunctionTok{save}\NormalTok{(census\_data, }\AttributeTok{file =} \StringTok{"../../data/census.rda"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{load}\NormalTok{(}\FunctionTok{here}\NormalTok{(}\StringTok{"data/census.rda"}\NormalTok{))}

\NormalTok{n }\OtherTok{\textless{}{-}} \FunctionTok{nrow}\NormalTok{(census\_data)}
\FunctionTok{kable}\NormalTok{(}\FunctionTok{head}\NormalTok{(census\_data[, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{]), }\AttributeTok{format =} \StringTok{"latex"}\NormalTok{, }\AttributeTok{booktabs =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{caption =} \StringTok{"Census Data, 2021 (truncated rows and columns)"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{kable\_styling}\NormalTok{(}\AttributeTok{latex\_options =} \FunctionTok{c}\NormalTok{(}\StringTok{"striped"}\NormalTok{, }\StringTok{"hold\_position"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\caption{\label{tab:table_1}Census Data, 2021 (truncated rows and columns)}
\centering
\begin{tabular}[t]{rlrlll}
\toprule
Shape Area & Type & Households & Quality Flags & name & geometry\\
\midrule
\cellcolor{gray!10}{0.2991} & \cellcolor{gray!10}{DA} & \cellcolor{gray!10}{266} & \cellcolor{gray!10}{0} & \cellcolor{gray!10}{59150307} & \cellcolor{gray!10}{MULTIPOLYGON (((-123.0231 4...}\\
0.1096 & DA & 218 & 0 & 59150308 & MULTIPOLYGON (((-123.0234 4...\\
\cellcolor{gray!10}{0.1119} & \cellcolor{gray!10}{DA} & \cellcolor{gray!10}{282} & \cellcolor{gray!10}{0} & \cellcolor{gray!10}{59150309} & \cellcolor{gray!10}{MULTIPOLYGON (((-123.0283 4...}\\
0.1094 & DA & 389 & 0 & 59150310 & MULTIPOLYGON (((-123.0234 4...\\
\cellcolor{gray!10}{0.0809} & \cellcolor{gray!10}{DA} & \cellcolor{gray!10}{187} & \cellcolor{gray!10}{0} & \cellcolor{gray!10}{59150311} & \cellcolor{gray!10}{MULTIPOLYGON (((-123.0257 4...}\\
\addlinespace
0.0871 & DA & 201 & 0 & 59150312 & MULTIPOLYGON (((-123.0234 4...\\
\bottomrule
\end{tabular}
\end{table}

\subsection{Food data}\label{food-data}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{food\_data }\OtherTok{\textless{}{-}} \FunctionTok{st\_read}\NormalTok{(}\FunctionTok{here}\NormalTok{(}\StringTok{"data/free{-}and{-}low{-}cost{-}food{-}programs.shp"}\NormalTok{))  }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}
    \StringTok{"program\_nam"}\NormalTok{,}
    \StringTok{"program\_sta"}\NormalTok{,}
    \StringTok{"meal\_cost"}\NormalTok{,}
    \StringTok{"local\_areas"}\NormalTok{,}
    \StringTok{"latitude"}\NormalTok{,}
    \StringTok{"longitude"}\NormalTok{,}
    \StringTok{"geometry"}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{drop\_na}\NormalTok{(}\StringTok{"latitude"}\NormalTok{, }\StringTok{"longitude"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\# set to wgs 84 as per can census}
  \FunctionTok{st\_set\_crs}\NormalTok{(}\DecValTok{4326}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Reading layer `free-and-low-cost-food-programs' from data source 
##   `/Users/sid/Documents/ubc classes/2024w1/econ 326/foodprograms/data/free-and-low-cost-food-programs.shp' 
##   using driver `ESRI Shapefile'
## replacing null geometries with empty geometries
## Simple feature collection with 83 features and 25 fields (with 2 geometries empty)
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: -123.1821 ymin: 49.20725 xmax: -123.0287 ymax: 49.286
## CRS:           NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Food data processing}
\NormalTok{food\_count }\OtherTok{\textless{}{-}}\NormalTok{ food\_data }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{st\_set\_geometry}\NormalTok{(}\ConstantTok{NULL}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(local\_areas) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{count =} \FunctionTok{n}\NormalTok{(), }\AttributeTok{.groups =} \StringTok{"drop"}\NormalTok{)}

\NormalTok{food\_data\_count }\OtherTok{\textless{}{-}}\NormalTok{ food\_data }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{left\_join}\NormalTok{(food\_count, }\AttributeTok{by =} \StringTok{"local\_areas"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{distinct}\NormalTok{(local\_areas, }\AttributeTok{.keep\_all =} \ConstantTok{TRUE}\NormalTok{) }\CommentTok{\# one row per neighbourhood}

\NormalTok{combo\_food\_census }\OtherTok{\textless{}{-}}\NormalTok{ census\_data }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{st\_join}\NormalTok{(food\_data\_count)}

\NormalTok{census\_data\_food }\OtherTok{\textless{}{-}}\NormalTok{ combo\_food\_census }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{program\_count =} \FunctionTok{replace\_na}\NormalTok{(count, }\DecValTok{0}\NormalTok{),}
         \AttributeTok{food\_density =}\NormalTok{ program\_count }\SpecialCharTok{/} \StringTok{\textasciigrave{}}\AttributeTok{Shape Area}\StringTok{\textasciigrave{}}\NormalTok{)}

\FunctionTok{head}\NormalTok{(census\_data\_food[, }\DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{]) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{kable}\NormalTok{(}\AttributeTok{format =} \StringTok{"latex"}\NormalTok{, }\AttributeTok{booktabs =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{caption =} \StringTok{"Food Data merged with Census Data, 2021 (truncated rows and columns)"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{kable\_styling}\NormalTok{(}\AttributeTok{latex\_options =} \FunctionTok{c}\NormalTok{(}\StringTok{"striped"}\NormalTok{, }\StringTok{"hold\_position"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\caption{\label{tab:table_2}Food Data merged with Census Data, 2021 (truncated rows and columns)}
\centering
\begin{tabular}[t]{rlrlll}
\toprule
Shape Area & Type & Households & Quality Flags & name & geometry\\
\midrule
\cellcolor{gray!10}{0.2991} & \cellcolor{gray!10}{DA} & \cellcolor{gray!10}{266} & \cellcolor{gray!10}{0} & \cellcolor{gray!10}{59150307} & \cellcolor{gray!10}{MULTIPOLYGON (((-123.0231 4...}\\
0.1096 & DA & 218 & 0 & 59150308 & MULTIPOLYGON (((-123.0234 4...\\
\cellcolor{gray!10}{0.1119} & \cellcolor{gray!10}{DA} & \cellcolor{gray!10}{282} & \cellcolor{gray!10}{0} & \cellcolor{gray!10}{59150309} & \cellcolor{gray!10}{MULTIPOLYGON (((-123.0283 4...}\\
0.1094 & DA & 389 & 0 & 59150310 & MULTIPOLYGON (((-123.0234 4...\\
\cellcolor{gray!10}{0.0809} & \cellcolor{gray!10}{DA} & \cellcolor{gray!10}{187} & \cellcolor{gray!10}{0} & \cellcolor{gray!10}{59150311} & \cellcolor{gray!10}{MULTIPOLYGON (((-123.0257 4...}\\
\addlinespace
0.0871 & DA & 201 & 0 & 59150312 & MULTIPOLYGON (((-123.0234 4...\\
\bottomrule
\end{tabular}
\end{table}

\_

\subsection{Crime data}\label{crime-data}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{crime }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\FunctionTok{here}\NormalTok{(}\StringTok{"data/crime\_data\_all\_neighborhoods.csv"}\NormalTok{), }\AttributeTok{show\_col\_types =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{TYPE =} \FunctionTok{as\_factor}\NormalTok{(TYPE),}
         \AttributeTok{HUNDRED\_BLOCK =} \FunctionTok{as\_factor}\NormalTok{(HUNDRED\_BLOCK),}
         \AttributeTok{NEIGHBOURHOOD =} \FunctionTok{as\_factor}\NormalTok{(NEIGHBOURHOOD)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(X) }\SpecialCharTok{\&} \SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(Y))}

\NormalTok{crime\_data }\OtherTok{\textless{}{-}} \FunctionTok{st\_as\_sf}\NormalTok{(crime, }\AttributeTok{coords =} \FunctionTok{c}\NormalTok{(}\StringTok{"X"}\NormalTok{, }\StringTok{"Y"}\NormalTok{), }\AttributeTok{crs =} \StringTok{"+proj=utm +zone=10"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{st\_transform}\NormalTok{(}\AttributeTok{crs =} \StringTok{"+proj=longlat +datum=WGS84"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{intersections }\OtherTok{\textless{}{-}} \FunctionTok{st\_is\_within\_distance}\NormalTok{(census\_data, crime\_data, }\AttributeTok{sparse =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{dist =} \DecValTok{5}\NormalTok{)}

\NormalTok{crimes\_contained }\OtherTok{\textless{}{-}} \FunctionTok{rowSums}\NormalTok{(intersections, }\AttributeTok{dims =} \DecValTok{1}\NormalTok{)}

\NormalTok{census\_data\_crime }\OtherTok{\textless{}{-}}\NormalTok{ census\_data }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{cbind}\NormalTok{(crimes\_contained) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{crime\_density =}\NormalTok{ crimes\_contained }\SpecialCharTok{/}\NormalTok{ Shape.Area)}

\NormalTok{unique\_crimes }\OtherTok{\textless{}{-}} \FunctionTok{unique}\NormalTok{(crime\_data}\SpecialCharTok{$}\NormalTok{TYPE)}

\ControlFlowTok{for}\NormalTok{ (type }\ControlFlowTok{in}\NormalTok{ unique\_crimes) \{}
\NormalTok{  type\_data }\OtherTok{\textless{}{-}}\NormalTok{ crime\_data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(TYPE }\SpecialCharTok{==}\NormalTok{ type)}
\NormalTok{  intersections }\OtherTok{\textless{}{-}} \FunctionTok{st\_is\_within\_distance}\NormalTok{(census\_data, type\_data, }\AttributeTok{sparse =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{dist =} \DecValTok{5}\NormalTok{)}
\NormalTok{  sum }\OtherTok{\textless{}{-}} \FunctionTok{rowSums}\NormalTok{(intersections, }\AttributeTok{dims =} \DecValTok{1}\NormalTok{)}
\NormalTok{  df }\OtherTok{\textless{}{-}} \FunctionTok{as.data.frame}\NormalTok{(sum)}
\NormalTok{  census\_data\_crime }\OtherTok{\textless{}{-}}\NormalTok{ census\_data\_crime }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{cbind}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{sum) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{rename\_with}\NormalTok{(}\SpecialCharTok{\textasciitilde{}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"crimes\_"}\NormalTok{, type), df.sum)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\subsection{Training data}\label{training-data}

Now we merge all of our data-sets into one table so we can feed it into
our model.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{training\_data }\OtherTok{\textless{}{-}} \FunctionTok{st\_join}\NormalTok{(census\_data\_crime, census\_data\_food)}

\NormalTok{training\_data }\OtherTok{\textless{}{-}}\NormalTok{ training\_data }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename\_with}\NormalTok{(}
    \SpecialCharTok{\textasciitilde{}} \FunctionTok{gsub}\NormalTok{(}\StringTok{":.*$"}\NormalTok{, }\StringTok{""}\NormalTok{, .),  }\CommentTok{\# Remove everything after the colon, including the colon}
    \FunctionTok{starts\_with}\NormalTok{(}\StringTok{"v\_CA21"}\NormalTok{)  }\CommentTok{\# Apply only to columns starting with "v\_CA21"}
\NormalTok{  )}

\NormalTok{median\_lico\_at }\OtherTok{\textless{}{-}} \FunctionTok{median}\NormalTok{(training\_data}\SpecialCharTok{$}\NormalTok{v\_CA21\_1085, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}

\NormalTok{training\_data }\OtherTok{\textless{}{-}}\NormalTok{ training\_data }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{low\_income =} \FunctionTok{ifelse}\NormalTok{(}
\NormalTok{      v\_CA21\_1085 }\SpecialCharTok{\textgreater{}}\NormalTok{ median\_lico\_at, }
      \DecValTok{1}\NormalTok{, }
      \DecValTok{0}\NormalTok{))}


\NormalTok{training\_data[}\FunctionTok{is.na}\NormalTok{(training\_data)] }\OtherTok{\textless{}{-}} \DecValTok{0}
\end{Highlighting}
\end{Shaded}

\section{Model}\label{model}

\subsection{Specification}\label{specification}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Specification models}
\CommentTok{\# 1. Model with all variables (including interaction term)}
\NormalTok{reg\_all\_vars }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(crime\_density }\SpecialCharTok{\textasciitilde{}} 
\NormalTok{                   food\_density}\SpecialCharTok{:}\NormalTok{low\_income }\SpecialCharTok{+} 
\NormalTok{                   food\_density }\SpecialCharTok{+} 
\NormalTok{                   pop\_density.x }\SpecialCharTok{+} 
\NormalTok{                   v\_CA21\_452 }\SpecialCharTok{+}
\NormalTok{                   low\_income, }
                 \AttributeTok{data =} \FunctionTok{st\_set\_geometry}\NormalTok{(training\_data, }\ConstantTok{NULL}\NormalTok{))}

\CommentTok{\# 2. Model without the interaction term}
\NormalTok{reg\_no\_interaction }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(crime\_density }\SpecialCharTok{\textasciitilde{}} 
\NormalTok{                         food\_density }\SpecialCharTok{+} 
\NormalTok{                         pop\_density.x }\SpecialCharTok{+} 
\NormalTok{                         v\_CA21\_452 }\SpecialCharTok{+}
\NormalTok{                         low\_income, }
                       \AttributeTok{data =} \FunctionTok{st\_set\_geometry}\NormalTok{(training\_data, }\ConstantTok{NULL}\NormalTok{))}

\CommentTok{\# 3. Model with only food density, crime density, and low income}
\NormalTok{reg\_food\_crime\_low\_income }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(crime\_density }\SpecialCharTok{\textasciitilde{}} 
\NormalTok{                                food\_density }\SpecialCharTok{+} 
\NormalTok{                                low\_income, }
                              \AttributeTok{data =} \FunctionTok{st\_set\_geometry}\NormalTok{(training\_data, }\ConstantTok{NULL}\NormalTok{))}

\CommentTok{\# 4. Model with all variables (including interaction term) but replacing v\_CA21\_452 with v\_CA21\_449}
\NormalTok{reg\_all\_vars\_449 }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(crime\_density }\SpecialCharTok{\textasciitilde{}} 
\NormalTok{                       food\_density}\SpecialCharTok{:}\NormalTok{low\_income }\SpecialCharTok{+} 
\NormalTok{                       food\_density }\SpecialCharTok{+} 
\NormalTok{                       pop\_density.x }\SpecialCharTok{+} 
\NormalTok{                       v\_CA21\_449 }\SpecialCharTok{+}  \CommentTok{\# Replaced v\_CA21\_452 with v\_CA21\_449}
\NormalTok{                       low\_income, }
                     \AttributeTok{data =} \FunctionTok{st\_set\_geometry}\NormalTok{(training\_data, }\ConstantTok{NULL}\NormalTok{))}

\NormalTok{models\_spec }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}
  \StringTok{"All Variables"} \OtherTok{=}\NormalTok{ reg\_all\_vars,}
  \StringTok{"Without Interaction"} \OtherTok{=}\NormalTok{ reg\_no\_interaction,}
  \StringTok{"Food Density, Crime, Low Income"} \OtherTok{=}\NormalTok{ reg\_food\_crime\_low\_income}
\NormalTok{)}

\CommentTok{\# Summary for each specification tested}
\NormalTok{summary\_all\_vars }\OtherTok{\textless{}{-}} \FunctionTok{summary}\NormalTok{(reg\_all\_vars)}
\NormalTok{summary\_no\_interaction }\OtherTok{\textless{}{-}} \FunctionTok{summary}\NormalTok{(reg\_no\_interaction)}
\NormalTok{summary\_food\_crime\_low\_income }\OtherTok{\textless{}{-}} \FunctionTok{summary}\NormalTok{(reg\_food\_crime\_low\_income)}
\NormalTok{summary\_all\_vars\_449 }\OtherTok{\textless{}{-}} \FunctionTok{summary}\NormalTok{(reg\_all\_vars\_449)}

\CommentTok{\# Add to the list of model summaries}
\NormalTok{model\_summaries }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}
  \StringTok{"All Variables"} \OtherTok{=}\NormalTok{ summary\_all\_vars,}
  \StringTok{"Without Interaction"} \OtherTok{=}\NormalTok{ summary\_no\_interaction,}
  \StringTok{"Food Density, Crime, Low Income"} \OtherTok{=}\NormalTok{ summary\_food\_crime\_low\_income,}
  \StringTok{"All Variables (with v\_CA21\_449)"} \OtherTok{=}\NormalTok{ summary\_all\_vars\_449}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\section{RESULTS FROM SPEC}\label{results-from-spec}

\subsubsection{Function definitions}\label{function-definitions}

We needed to manipulate our regression model data into formatted tables
that emulated those from the package \texttt{stargazer} as we were
having significant alignment issues between the data and rendered
tables.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{all\_variables }\OtherTok{\textless{}{-}} \FunctionTok{unique}\NormalTok{(}\FunctionTok{c}\NormalTok{(}
  \FunctionTok{names}\NormalTok{(}\FunctionTok{coef}\NormalTok{(reg\_all\_vars)),}
  \FunctionTok{names}\NormalTok{(}\FunctionTok{coef}\NormalTok{(reg\_no\_interaction)),}
  \FunctionTok{names}\NormalTok{(}\FunctionTok{coef}\NormalTok{(reg\_food\_crime\_low\_income))}
\NormalTok{))}

\NormalTok{all\_variables\_escaped }\OtherTok{\textless{}{-}} \FunctionTok{gsub}\NormalTok{(}\StringTok{"\_"}\NormalTok{, }\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}\textbackslash{}\textbackslash{}}\StringTok{\_"}\NormalTok{, all\_variables)  }\CommentTok{\# Escape underscores}
\NormalTok{all\_variables\_escaped }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{texttt\{"}\NormalTok{, all\_variables\_escaped, }\StringTok{"\}"}\NormalTok{)  }\CommentTok{\# Wrap in \textbackslash{}texttt\{\} for LaTeX}

\NormalTok{add\_stars }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(estimates, ses, p\_values) \{}
\NormalTok{  significance\_levels }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(p\_values }\SpecialCharTok{\textless{}} \FloatTok{0.01}\NormalTok{, }\StringTok{"***"}\NormalTok{,}
                          \FunctionTok{ifelse}\NormalTok{(p\_values }\SpecialCharTok{\textless{}} \FloatTok{0.05}\NormalTok{, }\StringTok{"**"}\NormalTok{,}
                          \FunctionTok{ifelse}\NormalTok{(p\_values }\SpecialCharTok{\textless{}} \FloatTok{0.1}\NormalTok{, }\StringTok{"*"}\NormalTok{, }\StringTok{""}\NormalTok{)))}
\NormalTok{  formatted }\OtherTok{\textless{}{-}} \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%.3f (\%.3f)\%s"}\NormalTok{, estimates, ses, significance\_levels)}
  \FunctionTok{return}\NormalTok{(formatted)}
\NormalTok{\}}

\NormalTok{extract\_summary }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(model, all\_vars) \{}
\NormalTok{  coefs }\OtherTok{\textless{}{-}} \FunctionTok{coef}\NormalTok{(model)}
\NormalTok{  ses }\OtherTok{\textless{}{-}} \FunctionTok{sqrt}\NormalTok{(}\FunctionTok{diag}\NormalTok{(}\FunctionTok{vcov}\NormalTok{(model)))}
\NormalTok{  p\_values }\OtherTok{\textless{}{-}} \FunctionTok{coef}\NormalTok{(}\FunctionTok{summary}\NormalTok{(model))[, }\DecValTok{4}\NormalTok{]  }\CommentTok{\# Extract p{-}values from the summary}

  \CommentTok{\# Create placeholders for all variables}
\NormalTok{  aligned\_coefs }\OtherTok{\textless{}{-}} \FunctionTok{setNames}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\ConstantTok{NA}\NormalTok{, }\FunctionTok{length}\NormalTok{(all\_vars)), all\_vars)}
\NormalTok{  aligned\_ses }\OtherTok{\textless{}{-}} \FunctionTok{setNames}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\ConstantTok{NA}\NormalTok{, }\FunctionTok{length}\NormalTok{(all\_vars)), all\_vars)}
\NormalTok{  aligned\_p\_values }\OtherTok{\textless{}{-}} \FunctionTok{setNames}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\ConstantTok{NA}\NormalTok{, }\FunctionTok{length}\NormalTok{(all\_vars)), all\_vars)}

  \CommentTok{\# Fill with existing coefficients, standard errors, and p{-}values}
  \ControlFlowTok{for}\NormalTok{ (var }\ControlFlowTok{in} \FunctionTok{names}\NormalTok{(coefs)) \{}
\NormalTok{    aligned\_coefs[var] }\OtherTok{\textless{}{-}}\NormalTok{ coefs[var]}
\NormalTok{    aligned\_ses[var] }\OtherTok{\textless{}{-}}\NormalTok{ ses[var]}
\NormalTok{    aligned\_p\_values[var] }\OtherTok{\textless{}{-}}\NormalTok{ p\_values[var]}
\NormalTok{  \}}

  \CommentTok{\# Replace missing coefficients with 0}
\NormalTok{  aligned\_coefs[}\FunctionTok{is.na}\NormalTok{(aligned\_coefs)] }\OtherTok{\textless{}{-}} \DecValTok{0}

  \CommentTok{\# Add stars to coefficients based on significance levels}
\NormalTok{  significance\_levels }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(aligned\_p\_values }\SpecialCharTok{\textless{}} \FloatTok{0.01}\NormalTok{, }\StringTok{"***"}\NormalTok{,}
                          \FunctionTok{ifelse}\NormalTok{(aligned\_p\_values }\SpecialCharTok{\textless{}} \FloatTok{0.05}\NormalTok{, }\StringTok{"**"}\NormalTok{,}
                          \FunctionTok{ifelse}\NormalTok{(aligned\_p\_values }\SpecialCharTok{\textless{}} \FloatTok{0.1}\NormalTok{, }\StringTok{"*"}\NormalTok{, }\StringTok{""}\NormalTok{)))}

  \CommentTok{\# Format coefficients and standard errors for display}
\NormalTok{  formatted }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(aligned\_ses),}
                      \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%.3f"}\NormalTok{, aligned\_coefs),}
                      \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%.3f (\%.3f)\%s"}\NormalTok{, aligned\_coefs, aligned\_ses, significance\_levels))}

  \CommentTok{\# Replace missing standard errors with blank strings}
\NormalTok{  formatted[}\FunctionTok{is.na}\NormalTok{(aligned\_ses)] }\OtherTok{\textless{}{-}} \StringTok{" "}

  \CommentTok{\# Escape underscores for LaTeX compatibility and wrap in \textbackslash{}texttt\{\} for table display}
\NormalTok{  formatted }\OtherTok{\textless{}{-}} \FunctionTok{gsub}\NormalTok{(}\StringTok{"\_"}\NormalTok{, }\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}\textbackslash{}\textbackslash{}}\StringTok{\_"}\NormalTok{, formatted)}
\NormalTok{  formatted }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{texttt\{"}\NormalTok{, formatted, }\StringTok{"\}"}\NormalTok{)}

  \FunctionTok{return}\NormalTok{(formatted)}
\NormalTok{\}}

\NormalTok{extract\_model\_info }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(model, covariate\_labels, model\_title) \{}
\NormalTok{  coefs }\OtherTok{\textless{}{-}} \FunctionTok{coef}\NormalTok{(model)}
\NormalTok{  ses }\OtherTok{\textless{}{-}} \FunctionTok{sqrt}\NormalTok{(}\FunctionTok{diag}\NormalTok{(}\FunctionTok{vcov}\NormalTok{(model)))}
\NormalTok{  p\_values }\OtherTok{\textless{}{-}} \FunctionTok{coef}\NormalTok{(}\FunctionTok{summary}\NormalTok{(model))[, }\DecValTok{4}\NormalTok{]  }\CommentTok{\# Extract p{-}values from the summary}
  
  \CommentTok{\# Format coefficients, standard errors, and significance stars}
\NormalTok{  significance\_levels }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(p\_values }\SpecialCharTok{\textless{}} \FloatTok{0.01}\NormalTok{, }\StringTok{"***"}\NormalTok{,}
                                \FunctionTok{ifelse}\NormalTok{(p\_values }\SpecialCharTok{\textless{}} \FloatTok{0.05}\NormalTok{, }\StringTok{"**"}\NormalTok{,}
                                       \FunctionTok{ifelse}\NormalTok{(p\_values }\SpecialCharTok{\textless{}} \FloatTok{0.1}\NormalTok{, }\StringTok{"*"}\NormalTok{, }\StringTok{""}\NormalTok{)))}
  
\NormalTok{  formatted }\OtherTok{\textless{}{-}} \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%.3f (\%.3f)\%s"}\NormalTok{, coefs, ses, significance\_levels)}
  
  \CommentTok{\# Combine covariate labels and the formatted coefficients}
\NormalTok{  result }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
    \AttributeTok{Variable =}\NormalTok{ covariate\_labels,}
    \AttributeTok{Estimate =}\NormalTok{ formatted,}
    \AttributeTok{stringsAsFactors =} \ConstantTok{FALSE}
\NormalTok{  )}
  
  \CommentTok{\# Add model title}
\NormalTok{  result }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(}\FunctionTok{data.frame}\NormalTok{(}\AttributeTok{Variable =}\NormalTok{ model\_title, }\AttributeTok{Estimate =} \StringTok{""}\NormalTok{, }\AttributeTok{stringsAsFactors =} \ConstantTok{FALSE}\NormalTok{), result)}
  
  \FunctionTok{return}\NormalTok{(result)}
\NormalTok{\}}



\CommentTok{\# Extract R{-}squared, F{-}statistics, and number of observations from each model}
\NormalTok{r\_squared }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \FunctionTok{summary}\NormalTok{(reg\_all\_vars)}\SpecialCharTok{$}\NormalTok{r.squared,}
  \FunctionTok{summary}\NormalTok{(reg\_no\_interaction)}\SpecialCharTok{$}\NormalTok{r.squared,}
  \FunctionTok{summary}\NormalTok{(reg\_food\_crime\_low\_income)}\SpecialCharTok{$}\NormalTok{r.squared}
\NormalTok{)}

\NormalTok{f\_statistic }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \FunctionTok{summary}\NormalTok{(reg\_all\_vars)}\SpecialCharTok{$}\NormalTok{fstatistic[}\DecValTok{1}\NormalTok{],}
  \FunctionTok{summary}\NormalTok{(reg\_no\_interaction)}\SpecialCharTok{$}\NormalTok{fstatistic[}\DecValTok{1}\NormalTok{],}
  \FunctionTok{summary}\NormalTok{(reg\_food\_crime\_low\_income)}\SpecialCharTok{$}\NormalTok{fstatistic[}\DecValTok{1}\NormalTok{]}
\NormalTok{)}

\NormalTok{n\_obs }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \FunctionTok{length}\NormalTok{(reg\_all\_vars}\SpecialCharTok{$}\NormalTok{fitted.values),}
  \FunctionTok{length}\NormalTok{(reg\_no\_interaction}\SpecialCharTok{$}\NormalTok{fitted.values),}
  \FunctionTok{length}\NormalTok{(reg\_food\_crime\_low\_income}\SpecialCharTok{$}\NormalTok{fitted.values)}
\NormalTok{)}


\NormalTok{model1\_aligned }\OtherTok{\textless{}{-}} \FunctionTok{extract\_summary}\NormalTok{(reg\_all\_vars, all\_variables)}
\NormalTok{model2\_aligned }\OtherTok{\textless{}{-}} \FunctionTok{extract\_summary}\NormalTok{(reg\_no\_interaction, all\_variables)}
\NormalTok{model3\_aligned }\OtherTok{\textless{}{-}} \FunctionTok{extract\_summary}\NormalTok{(reg\_food\_crime\_low\_income, all\_variables)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Data manipulation}\label{data-manipulation}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{aligned\_table }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{Variable =}\NormalTok{ all\_variables\_escaped,}
  \StringTok{\textasciigrave{}}\AttributeTok{Model 1}\StringTok{\textasciigrave{}} \OtherTok{=}\NormalTok{ model1\_aligned,}
  \StringTok{\textasciigrave{}}\AttributeTok{Model 2}\StringTok{\textasciigrave{}} \OtherTok{=}\NormalTok{ model2\_aligned,}
  \StringTok{\textasciigrave{}}\AttributeTok{Model 3}\StringTok{\textasciigrave{}} \OtherTok{=}\NormalTok{ model3\_aligned,}
  \AttributeTok{stringsAsFactors =} \ConstantTok{FALSE}
\NormalTok{)}

\FunctionTok{print}\NormalTok{(aligned\_table)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                                Variable                        Model.1
## 1                 \\texttt{(Intercept)} \\texttt{1291.286 (62.011)***}
## 2              \\texttt{food\\_density}       \\texttt{-0.203 (2.154)}
## 3             \\texttt{pop\\_density.x}     \\texttt{0.043 (0.001)***}
## 4              \\texttt{v\\_CA21\\_452} \\texttt{-517.756 (22.439)***}
## 5                \\texttt{low\\_income}  \\texttt{244.697 (24.734)***}
## 6 \\texttt{food\\_density:low\\_income}     \\texttt{9.460 (2.305)***}
##                          Model.2                       Model.3
## 1 \\texttt{1283.891 (62.047)***} \\texttt{383.969 (18.802)***}
## 2     \\texttt{8.053 (0.771)***}    \\texttt{9.631 (0.897)***}
## 3     \\texttt{0.044 (0.001)***}                   \\texttt{ }
## 4 \\texttt{-517.272 (22.461)***}                   \\texttt{ }
## 5  \\texttt{252.689 (24.682)***} \\texttt{577.872 (27.744)***}
## 6                    \\texttt{ }                   \\texttt{ }
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{summary\_table }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{Variable =} \FunctionTok{c}\NormalTok{(}\StringTok{"R squared"}\NormalTok{, }\StringTok{"F statistic"}\NormalTok{, }\StringTok{"Observations"}\NormalTok{),}
  \StringTok{\textasciigrave{}}\AttributeTok{Model 1}\StringTok{\textasciigrave{}} \OtherTok{=} \FunctionTok{c}\NormalTok{(}\FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%.3f"}\NormalTok{, r\_squared[}\DecValTok{1}\NormalTok{]), }\FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%.1f"}\NormalTok{, f\_statistic[}\DecValTok{1}\NormalTok{]), n\_obs[}\DecValTok{1}\NormalTok{]),}
  \StringTok{\textasciigrave{}}\AttributeTok{Model 2}\StringTok{\textasciigrave{}} \OtherTok{=} \FunctionTok{c}\NormalTok{(}\FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%.3f"}\NormalTok{, r\_squared[}\DecValTok{2}\NormalTok{]), }\FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%.1f"}\NormalTok{, f\_statistic[}\DecValTok{2}\NormalTok{]), n\_obs[}\DecValTok{2}\NormalTok{]),}
  \StringTok{\textasciigrave{}}\AttributeTok{Model 3}\StringTok{\textasciigrave{}} \OtherTok{=} \FunctionTok{c}\NormalTok{(}\FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%.3f"}\NormalTok{, r\_squared[}\DecValTok{3}\NormalTok{]), }\FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%.1f"}\NormalTok{, f\_statistic[}\DecValTok{3}\NormalTok{]), n\_obs[}\DecValTok{3}\NormalTok{]),}
  \AttributeTok{stringsAsFactors =} \ConstantTok{FALSE}
\NormalTok{)}

\CommentTok{\# Combine both tables}
\NormalTok{final\_table }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(aligned\_table, summary\_table)}
\FunctionTok{print}\NormalTok{(final\_table)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                                Variable                        Model.1
## 1                 \\texttt{(Intercept)} \\texttt{1291.286 (62.011)***}
## 2              \\texttt{food\\_density}       \\texttt{-0.203 (2.154)}
## 3             \\texttt{pop\\_density.x}     \\texttt{0.043 (0.001)***}
## 4              \\texttt{v\\_CA21\\_452} \\texttt{-517.756 (22.439)***}
## 5                \\texttt{low\\_income}  \\texttt{244.697 (24.734)***}
## 6 \\texttt{food\\_density:low\\_income}     \\texttt{9.460 (2.305)***}
## 7                             R squared                          0.315
## 8                           F statistic                          721.0
## 9                          Observations                           7860
##                          Model.2                       Model.3
## 1 \\texttt{1283.891 (62.047)***} \\texttt{383.969 (18.802)***}
## 2     \\texttt{8.053 (0.771)***}    \\texttt{9.631 (0.897)***}
## 3     \\texttt{0.044 (0.001)***}                   \\texttt{ }
## 4 \\texttt{-517.272 (22.461)***}                   \\texttt{ }
## 5  \\texttt{252.689 (24.682)***} \\texttt{577.872 (27.744)***}
## 6                    \\texttt{ }                   \\texttt{ }
## 7                          0.313                         0.067
## 8                          895.2                         282.6
## 9                           7860                          7860
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{covariate\_labels }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \StringTok{"(Intercept)"}\NormalTok{, }
  \StringTok{"Food Program Density: Low Income"}\NormalTok{,}
  \StringTok{"Food Program Density"}\NormalTok{,}
  \StringTok{"Population Density"}\NormalTok{, }
  \StringTok{"Average Household Size (v}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{\_CA21}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{\_452)"}\NormalTok{,}
  \StringTok{"Low Income"}
\NormalTok{)}
\NormalTok{covariate\_labels\_2 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \StringTok{"(Intercept)"}\NormalTok{,}
  \StringTok{"Food Program Density"}\NormalTok{,}
  \StringTok{"Population Density"}\NormalTok{, }
  \StringTok{"Average Household Size (v}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{\_CA21}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{\_452)"}\NormalTok{,}
  \StringTok{"Low Income"}
\NormalTok{)}

\NormalTok{covariate\_labels\_3 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \StringTok{"(Intercept)"}\NormalTok{,}
  \StringTok{"Food Program Density"}\NormalTok{,}
  \StringTok{"Low Income"}
\NormalTok{)}

\NormalTok{model\_1\_table }\OtherTok{\textless{}{-}} \FunctionTok{extract\_model\_info}\NormalTok{(}
  \AttributeTok{model =}\NormalTok{ reg\_all\_vars,}
  \AttributeTok{covariate\_labels =}\NormalTok{ covariate\_labels,}
  \AttributeTok{model\_title =} \StringTok{"Spec 1: All Variables"}
\NormalTok{)}

\NormalTok{model\_2\_table }\OtherTok{\textless{}{-}} \FunctionTok{extract\_model\_info}\NormalTok{(}
  \AttributeTok{model =}\NormalTok{ reg\_no\_interaction,}
  \AttributeTok{covariate\_labels =}\NormalTok{ covariate\_labels\_2,}
  \AttributeTok{model\_title =} \StringTok{"Spec 2: Omitted Interaction Term"}
\NormalTok{)}

\NormalTok{model\_3\_table }\OtherTok{\textless{}{-}} \FunctionTok{extract\_model\_info}\NormalTok{(}
  \AttributeTok{model =}\NormalTok{ reg\_food\_crime\_low\_income,}
  \AttributeTok{covariate\_labels =}\NormalTok{ covariate\_labels\_3,}
  \AttributeTok{model\_title =} \StringTok{"Spec 3: Food Density and Low Income"}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Regression table}\label{regression-table}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Render the final table in a stargazer{-}like format using knitr::kable}
\FunctionTok{kable}\NormalTok{(}
\NormalTok{  final\_table,}
  \AttributeTok{format =} \StringTok{"latex"}\NormalTok{,}
  \AttributeTok{col.names =} \FunctionTok{c}\NormalTok{(}\StringTok{"Variable"}\NormalTok{, }\StringTok{"Model 1"}\NormalTok{, }\StringTok{"Model 2"}\NormalTok{, }\StringTok{"Model 3"}\NormalTok{),}
  \AttributeTok{caption =} \StringTok{"Regression Specifications"}\NormalTok{,}
  \AttributeTok{align =} \StringTok{"lccc"}\NormalTok{,}
  \AttributeTok{booktabs =} \ConstantTok{TRUE}\NormalTok{,}
  \AttributeTok{escape =} \ConstantTok{FALSE}
\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{kable\_styling}\NormalTok{(}\AttributeTok{latex\_options =} \FunctionTok{c}\NormalTok{(}\StringTok{"hold\_position"}\NormalTok{, }\StringTok{"striped"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{add\_header\_above}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{" "} \OtherTok{=} \DecValTok{1}\NormalTok{, }\StringTok{"Dependent Variable: Crime Density"} \OtherTok{=} \DecValTok{3}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{footnote}\NormalTok{(}\AttributeTok{general =} \StringTok{"* p \textless{} 0.1; ** p \textless{} 0.05; *** p \textless{} 0.01"}\NormalTok{, }
           \AttributeTok{general\_title =} \StringTok{"Note:"}\NormalTok{, }
           \AttributeTok{footnote\_as\_chunk =} \ConstantTok{TRUE}\NormalTok{, }
           \AttributeTok{escape =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\caption{\label{tab:unnamed-chunk-10}Regression Specifications}
\centering
\begin{tabular}[t]{lccc}
\toprule
\multicolumn{1}{c}{ } & \multicolumn{3}{c}{Dependent Variable: Crime Density} \\
\cmidrule(l{3pt}r{3pt}){2-4}
Variable & Model 1 & Model 2 & Model 3\\
\midrule
\cellcolor{gray!10}{\texttt{(Intercept)}} & \cellcolor{gray!10}{\texttt{1291.286 (62.011)***}} & \cellcolor{gray!10}{\texttt{1283.891 (62.047)***}} & \cellcolor{gray!10}{\texttt{383.969 (18.802)***}}\\
\texttt{food\_density} & \texttt{-0.203 (2.154)} & \texttt{8.053 (0.771)***} & \texttt{9.631 (0.897)***}\\
\cellcolor{gray!10}{\texttt{pop\_density.x}} & \cellcolor{gray!10}{\texttt{0.043 (0.001)***}} & \cellcolor{gray!10}{\texttt{0.044 (0.001)***}} & \cellcolor{gray!10}{\texttt{ }}\\
\texttt{v\_CA21\_452} & \texttt{-517.756 (22.439)***} & \texttt{-517.272 (22.461)***} & \texttt{ }\\
\cellcolor{gray!10}{\texttt{low\_income}} & \cellcolor{gray!10}{\texttt{244.697 (24.734)***}} & \cellcolor{gray!10}{\texttt{252.689 (24.682)***}} & \cellcolor{gray!10}{\texttt{577.872 (27.744)***}}\\
\addlinespace
\texttt{food\_density:low\_income} & \texttt{9.460 (2.305)***} & \texttt{ } & \texttt{ }\\
\cellcolor{gray!10}{R squared} & \cellcolor{gray!10}{0.315} & \cellcolor{gray!10}{0.313} & \cellcolor{gray!10}{0.067}\\
F statistic & 721.0 & 895.2 & 282.6\\
\cellcolor{gray!10}{Observations} & \cellcolor{gray!10}{7860} & \cellcolor{gray!10}{7860} & \cellcolor{gray!10}{7860}\\
\bottomrule
\multicolumn{4}{l}{\rule{0pt}{1em}\textit{Note:} * p < 0.1; ** p < 0.05; *** p < 0.01}\\
\end{tabular}
\end{table}

\subsubsection{Model 1:}\label{model-1}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Model 1: reg\_all\_vars}
\FunctionTok{kable}\NormalTok{(}
\NormalTok{  model\_1\_table,}
  \AttributeTok{format =} \StringTok{"latex"}\NormalTok{,}
  \AttributeTok{col.names =} \FunctionTok{c}\NormalTok{(}\StringTok{"Variable"}\NormalTok{, }\StringTok{"Estimate"}\NormalTok{),}
  \AttributeTok{caption =} \StringTok{"All Variables (Model 1)"}\NormalTok{,}
  \AttributeTok{align =} \StringTok{"lc"}\NormalTok{,}
  \AttributeTok{booktabs =} \ConstantTok{TRUE}\NormalTok{,}
  \AttributeTok{escape =} \ConstantTok{FALSE}
\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{kable\_styling}\NormalTok{(}\AttributeTok{latex\_options =} \FunctionTok{c}\NormalTok{(}\StringTok{"hold\_position"}\NormalTok{, }\StringTok{"striped"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{footnote}\NormalTok{(}\AttributeTok{general =} \StringTok{"* p \textless{} 0.1; ** p \textless{} 0.05; *** p \textless{} 0.01"}\NormalTok{, }
           \AttributeTok{general\_title =} \StringTok{"Note:"}\NormalTok{, }
           \AttributeTok{footnote\_as\_chunk =} \ConstantTok{TRUE}\NormalTok{, }
           \AttributeTok{escape =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\caption{\label{tab:unnamed-chunk-11}All Variables (Model 1)}
\centering
\begin{tabular}[t]{lc}
\toprule
Variable & Estimate\\
\midrule
\cellcolor{gray!10}{Spec 1: All Variables} & \cellcolor{gray!10}{}\\
(Intercept) & 1291.286 (62.011)***\\
\cellcolor{gray!10}{Food Program Density: Low Income} & \cellcolor{gray!10}{-0.203 (2.154)}\\
Food Program Density & 0.043 (0.001)***\\
\cellcolor{gray!10}{Population Density} & \cellcolor{gray!10}{-517.756 (22.439)***}\\
\addlinespace
Average Household Size (v\_CA21\_452) & 244.697 (24.734)***\\
\cellcolor{gray!10}{Low Income} & \cellcolor{gray!10}{9.460 (2.305)***}\\
\bottomrule
\multicolumn{2}{l}{\rule{0pt}{1em}\textit{Note:} * p < 0.1; ** p < 0.05; *** p < 0.01}\\
\end{tabular}
\end{table}

\subsubsection{Model 2:}\label{model-2}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Model 2: reg\_no\_interaction}
\FunctionTok{kable}\NormalTok{(}
\NormalTok{  model\_2\_table,}
  \AttributeTok{format =} \StringTok{"latex"}\NormalTok{,}
  \AttributeTok{col.names =} \FunctionTok{c}\NormalTok{(}\StringTok{"Variable"}\NormalTok{, }\StringTok{"Estimate"}\NormalTok{),}
  \AttributeTok{caption =} \StringTok{"Omitted Interaction Term (Model 2)"}\NormalTok{,}
  \AttributeTok{align =} \StringTok{"lc"}\NormalTok{,}
  \AttributeTok{booktabs =} \ConstantTok{TRUE}\NormalTok{,}
  \AttributeTok{escape =} \ConstantTok{FALSE}
\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{kable\_styling}\NormalTok{(}\AttributeTok{latex\_options =} \FunctionTok{c}\NormalTok{(}\StringTok{"hold\_position"}\NormalTok{, }\StringTok{"striped"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{footnote}\NormalTok{(}\AttributeTok{general =} \StringTok{"* p \textless{} 0.1; ** p \textless{} 0.05; *** p \textless{} 0.01"}\NormalTok{, }
           \AttributeTok{general\_title =} \StringTok{"Note:"}\NormalTok{, }
           \AttributeTok{footnote\_as\_chunk =} \ConstantTok{TRUE}\NormalTok{, }
           \AttributeTok{escape =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\caption{\label{tab:unnamed-chunk-12}Omitted Interaction Term (Model 2)}
\centering
\begin{tabular}[t]{lc}
\toprule
Variable & Estimate\\
\midrule
\cellcolor{gray!10}{Spec 2: Omitted Interaction Term} & \cellcolor{gray!10}{}\\
(Intercept) & 1283.891 (62.047)***\\
\cellcolor{gray!10}{Food Program Density} & \cellcolor{gray!10}{8.053 (0.771)***}\\
Population Density & 0.044 (0.001)***\\
\cellcolor{gray!10}{Average Household Size (v\_CA21\_452)} & \cellcolor{gray!10}{-517.272 (22.461)***}\\
\addlinespace
Low Income & 252.689 (24.682)***\\
\bottomrule
\multicolumn{2}{l}{\rule{0pt}{1em}\textit{Note:} * p < 0.1; ** p < 0.05; *** p < 0.01}\\
\end{tabular}
\end{table}

\subsubsection{Model 3:}\label{model-3}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Model 3: reg\_food\_crime\_low\_income}
\FunctionTok{kable}\NormalTok{(}
\NormalTok{  model\_3\_table,}
  \AttributeTok{format =} \StringTok{"latex"}\NormalTok{,}
  \AttributeTok{col.names =} \FunctionTok{c}\NormalTok{(}\StringTok{"Variable"}\NormalTok{, }\StringTok{"Estimate"}\NormalTok{),}
  \AttributeTok{caption =} \StringTok{"Food Density and Low Income (Model 3)"}\NormalTok{,}
  \AttributeTok{align =} \StringTok{"lc"}\NormalTok{,}
  \AttributeTok{booktabs =} \ConstantTok{TRUE}\NormalTok{,}
  \AttributeTok{escape =} \ConstantTok{FALSE}
\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{kable\_styling}\NormalTok{(}\AttributeTok{latex\_options =} \FunctionTok{c}\NormalTok{(}\StringTok{"hold\_position"}\NormalTok{, }\StringTok{"striped"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{footnote}\NormalTok{(}\AttributeTok{general =} \StringTok{"* p \textless{} 0.1; ** p \textless{} 0.05; *** p \textless{} 0.01"}\NormalTok{, }
           \AttributeTok{general\_title =} \StringTok{"Note:"}\NormalTok{, }
           \AttributeTok{footnote\_as\_chunk =} \ConstantTok{TRUE}\NormalTok{, }
           \AttributeTok{escape =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\caption{\label{tab:unnamed-chunk-13}Food Density and Low Income (Model 3)}
\centering
\begin{tabular}[t]{lc}
\toprule
Variable & Estimate\\
\midrule
\cellcolor{gray!10}{Spec 3: Food Density and Low Income} & \cellcolor{gray!10}{}\\
(Intercept) & 383.969 (18.802)***\\
\cellcolor{gray!10}{Food Program Density} & \cellcolor{gray!10}{9.631 (0.897)***}\\
Low Income & 577.872 (27.744)***\\
\bottomrule
\multicolumn{2}{l}{\rule{0pt}{1em}\textit{Note:} * p < 0.1; ** p < 0.05; *** p < 0.01}\\
\end{tabular}
\end{table}

\subsection{Robustness}\label{robustness}

We split the data into sub-groups based on

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{census\_data\_centroids }\OtherTok{\textless{}{-}}\NormalTok{ census\_data }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{centroid =} \FunctionTok{st\_centroid}\NormalTok{(geometry),}
    \AttributeTok{latitude =} \FunctionTok{st\_coordinates}\NormalTok{(centroid)[, }\DecValTok{2}\NormalTok{],}
    \AttributeTok{longitude =} \FunctionTok{st\_coordinates}\NormalTok{(centroid)[, }\DecValTok{1}\NormalTok{]}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{st\_set\_geometry}\NormalTok{(}\ConstantTok{NULL}\NormalTok{)  }\CommentTok{\# Remove geometry for k{-}means input}

\CommentTok{\# Normalize latitude and longitude for clustering}
\NormalTok{census\_data\_normalized }\OtherTok{\textless{}{-}}\NormalTok{ census\_data\_centroids }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{latitude\_scaled =} \FunctionTok{scale}\NormalTok{(latitude),}
    \AttributeTok{longitude\_scaled =} \FunctionTok{scale}\NormalTok{(longitude)}
\NormalTok{  )}


\FunctionTok{set.seed}\NormalTok{(}\DecValTok{123}\NormalTok{) }\CommentTok{\# For reproducibility}
\NormalTok{k }\OtherTok{\textless{}{-}} \DecValTok{4}

\NormalTok{kmeans\_result }\OtherTok{\textless{}{-}} \FunctionTok{kmeans}\NormalTok{(census\_data\_normalized[, }\FunctionTok{c}\NormalTok{(}\StringTok{"latitude\_scaled"}\NormalTok{, }\StringTok{"longitude\_scaled"}\NormalTok{)], }\AttributeTok{centers =}\NormalTok{ k)}

\CommentTok{\# Add cluster assignments to the original data}
\NormalTok{census\_data}\SpecialCharTok{$}\NormalTok{cluster }\OtherTok{\textless{}{-}}\NormalTok{ kmeans\_result}\SpecialCharTok{$}\NormalTok{cluster}

\CommentTok{\# Now, merge the cluster assignments into your training data}
\NormalTok{training\_data }\OtherTok{\textless{}{-}} \FunctionTok{st\_join}\NormalTok{(training\_data, }
\NormalTok{                         census\_data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(cluster, geometry), }
                         \AttributeTok{left =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Run the model for each cluster}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\NormalTok{k) \{}
\NormalTok{  subset\_data }\OtherTok{\textless{}{-}}\NormalTok{ training\_data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(cluster }\SpecialCharTok{==}\NormalTok{ i)}
  
\NormalTok{  model }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(crime\_density }\SpecialCharTok{\textasciitilde{}} 
\NormalTok{                food\_density}\SpecialCharTok{:}\NormalTok{low\_income }\SpecialCharTok{+} 
\NormalTok{                food\_density }\SpecialCharTok{+} 
\NormalTok{                pop\_density.x }\SpecialCharTok{+} 
\NormalTok{                v\_CA21\_452 }\SpecialCharTok{+}
\NormalTok{                low\_income, }
              \AttributeTok{data =} \FunctionTok{st\_set\_geometry}\NormalTok{(subset\_data, }\ConstantTok{NULL}\NormalTok{))}
  
  \FunctionTok{cat}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{Model Summary for Cluster"}\NormalTok{, i, }\StringTok{":}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{))}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{summary}\NormalTok{(model)) }\CommentTok{\# Check the results for each cluster}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Model Summary for Cluster 1 :
## 
## Call:
## lm(formula = crime_density ~ food_density:low_income + food_density + 
##     pop_density.x + v_CA21_452 + low_income, data = st_set_geometry(subset_data, 
##     NULL))
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -1216.1  -147.9   -59.4    51.4  4377.5 
## 
## Coefficients:
##                           Estimate Std. Error t value Pr(>|t|)    
## (Intercept)              8.200e+02  1.759e+01  46.611   <2e-16 ***
## food_density             6.652e-01  2.692e-01   2.471   0.0135 *  
## pop_density.x            2.683e-02  5.950e-04  45.102   <2e-16 ***
## v_CA21_452              -2.569e+02  6.370e+00 -40.326   <2e-16 ***
## low_income              -1.282e+01  6.522e+00  -1.965   0.0494 *  
## food_density:low_income -2.648e-01  3.629e-01  -0.730   0.4657    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 321.8 on 15892 degrees of freedom
## Multiple R-squared:  0.2516, Adjusted R-squared:  0.2514 
## F-statistic:  1068 on 5 and 15892 DF,  p-value: < 2.2e-16
## 
## 
## Model Summary for Cluster 2 :
## 
## Call:
## lm(formula = crime_density ~ food_density:low_income + food_density + 
##     pop_density.x + v_CA21_452 + low_income, data = st_set_geometry(subset_data, 
##     NULL))
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4251.5 -1104.8  -406.5   361.3 10754.9 
## 
## Coefficients:
##                           Estimate Std. Error t value Pr(>|t|)    
## (Intercept)              3.079e+03  9.577e+01  32.156  < 2e-16 ***
## food_density            -7.841e+00  5.525e+00  -1.419  0.15587    
## pop_density.x            2.622e-02  1.052e-03  24.929  < 2e-16 ***
## v_CA21_452              -1.397e+03  5.016e+01 -27.842  < 2e-16 ***
## low_income               9.276e+02  3.169e+01  29.269  < 2e-16 ***
## food_density:low_income  1.671e+01  5.552e+00   3.010  0.00262 ** 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 1847 on 16445 degrees of freedom
## Multiple R-squared:  0.1932, Adjusted R-squared:  0.1929 
## F-statistic: 787.4 on 5 and 16445 DF,  p-value: < 2.2e-16
## 
## 
## Model Summary for Cluster 3 :
## 
## Call:
## lm(formula = crime_density ~ food_density:low_income + food_density + 
##     pop_density.x + v_CA21_452 + low_income, data = st_set_geometry(subset_data, 
##     NULL))
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -272.32  -71.09  -22.73   34.85 1205.21 
## 
## Coefficients:
##                           Estimate Std. Error t value Pr(>|t|)    
## (Intercept)              2.369e+02  7.746e+00  30.583  < 2e-16 ***
## food_density             9.935e-01  2.953e-01   3.364  0.00077 ***
## pop_density.x            1.591e-02  1.574e-04 101.094  < 2e-16 ***
## v_CA21_452              -5.109e+01  2.627e+00 -19.451  < 2e-16 ***
## low_income               5.528e+00  2.231e+00   2.478  0.01322 *  
## food_density:low_income -2.823e+00  4.270e-01  -6.610 3.94e-11 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 133.4 on 18348 degrees of freedom
## Multiple R-squared:  0.385,  Adjusted R-squared:  0.3849 
## F-statistic:  2298 on 5 and 18348 DF,  p-value: < 2.2e-16
## 
## 
## Model Summary for Cluster 4 :
## 
## Call:
## lm(formula = crime_density ~ food_density:low_income + food_density + 
##     pop_density.x + v_CA21_452 + low_income, data = st_set_geometry(subset_data, 
##     NULL))
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -415.34  -62.84  -24.39   41.99  783.31 
## 
## Coefficients:
##                           Estimate Std. Error t value Pr(>|t|)    
## (Intercept)              6.664e+01  4.931e+00  13.513  < 2e-16 ***
## food_density             5.133e+00  4.278e-01  11.997  < 2e-16 ***
## pop_density.x            1.237e-02  2.701e-04  45.811  < 2e-16 ***
## v_CA21_452              -1.375e+01  1.908e+00  -7.206 6.13e-13 ***
## low_income               3.670e+01  2.923e+00  12.556  < 2e-16 ***
## food_density:low_income -5.226e-01  6.081e-01  -0.859     0.39    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 127.7 on 11341 degrees of freedom
## Multiple R-squared:  0.2003, Adjusted R-squared:  0.1999 
## F-statistic:   568 on 5 and 11341 DF,  p-value: < 2.2e-16
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Step 1: Prepare a container for the model results}
\NormalTok{cluster\_summary\_table }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(rbind, }\FunctionTok{lapply}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\NormalTok{k, }\ControlFlowTok{function}\NormalTok{(i) \{}
\NormalTok{  subset\_data }\OtherTok{\textless{}{-}}\NormalTok{ training\_data }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(cluster }\SpecialCharTok{==}\NormalTok{ i)}
  
  \CommentTok{\# Run the linear model for each cluster}
\NormalTok{  model }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(crime\_density }\SpecialCharTok{\textasciitilde{}} 
\NormalTok{                food\_density}\SpecialCharTok{:}\NormalTok{low\_income }\SpecialCharTok{+} 
\NormalTok{                food\_density }\SpecialCharTok{+} 
\NormalTok{                pop\_density.x }\SpecialCharTok{+} 
\NormalTok{                v\_CA21\_452 }\SpecialCharTok{+}
\NormalTok{                low\_income, }
              \AttributeTok{data =} \FunctionTok{st\_set\_geometry}\NormalTok{(subset\_data, }\ConstantTok{NULL}\NormalTok{))}
  
\NormalTok{  model\_summary }\OtherTok{\textless{}{-}} \FunctionTok{summary}\NormalTok{(model)}
  
  \CommentTok{\# Extract coefficients, standard errors, p{-}values, and significance levels}
\NormalTok{  coefs }\OtherTok{\textless{}{-}} \FunctionTok{coef}\NormalTok{(model)}
\NormalTok{  ses }\OtherTok{\textless{}{-}} \FunctionTok{sqrt}\NormalTok{(}\FunctionTok{diag}\NormalTok{(}\FunctionTok{vcov}\NormalTok{(model)))}
\NormalTok{  p\_values }\OtherTok{\textless{}{-}} \FunctionTok{coef}\NormalTok{(}\FunctionTok{summary}\NormalTok{(model))[, }\DecValTok{4}\NormalTok{]}
  
  \CommentTok{\# Calculate significance levels for coefficients}
\NormalTok{  significance\_levels }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(p\_values }\SpecialCharTok{\textless{}} \FloatTok{0.01}\NormalTok{, }\StringTok{"***"}\NormalTok{,}
                          \FunctionTok{ifelse}\NormalTok{(p\_values }\SpecialCharTok{\textless{}} \FloatTok{0.05}\NormalTok{, }\StringTok{"**"}\NormalTok{,}
                          \FunctionTok{ifelse}\NormalTok{(p\_values }\SpecialCharTok{\textless{}} \FloatTok{0.1}\NormalTok{, }\StringTok{"*"}\NormalTok{, }\StringTok{""}\NormalTok{)))}
  
  \CommentTok{\# Format coefficients with standard errors and significance levels}
\NormalTok{  estimates }\OtherTok{\textless{}{-}} \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%.3f (\%.3f)\%s"}\NormalTok{, coefs, ses, significance\_levels)}

  \CommentTok{\# Create a data frame for the cluster summary}
  \FunctionTok{data.frame}\NormalTok{(}
    \AttributeTok{Cluster =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Cluster"}\NormalTok{, i),}
    \StringTok{\textasciigrave{}}\AttributeTok{(Intercept)}\StringTok{\textasciigrave{}} \OtherTok{=}\NormalTok{ estimates[}\DecValTok{1}\NormalTok{],}
    \StringTok{\textasciigrave{}}\AttributeTok{food\_density}\StringTok{\textasciigrave{}} \OtherTok{=} \FunctionTok{ifelse}\NormalTok{(}\FunctionTok{length}\NormalTok{(estimates) }\SpecialCharTok{\textgreater{}=} \DecValTok{2}\NormalTok{, estimates[}\DecValTok{2}\NormalTok{], }\ConstantTok{NA}\NormalTok{),}
    \StringTok{\textasciigrave{}}\AttributeTok{pop\_density.x}\StringTok{\textasciigrave{}} \OtherTok{=} \FunctionTok{ifelse}\NormalTok{(}\FunctionTok{length}\NormalTok{(estimates) }\SpecialCharTok{\textgreater{}=} \DecValTok{3}\NormalTok{, estimates[}\DecValTok{3}\NormalTok{], }\ConstantTok{NA}\NormalTok{),}
    \StringTok{\textasciigrave{}}\AttributeTok{v\_CA21\_452}\StringTok{\textasciigrave{}} \OtherTok{=} \FunctionTok{ifelse}\NormalTok{(}\FunctionTok{length}\NormalTok{(estimates) }\SpecialCharTok{\textgreater{}=} \DecValTok{4}\NormalTok{, estimates[}\DecValTok{4}\NormalTok{], }\ConstantTok{NA}\NormalTok{),}
    \StringTok{\textasciigrave{}}\AttributeTok{low\_income}\StringTok{\textasciigrave{}} \OtherTok{=} \FunctionTok{ifelse}\NormalTok{(}\FunctionTok{length}\NormalTok{(estimates) }\SpecialCharTok{\textgreater{}=} \DecValTok{5}\NormalTok{, estimates[}\DecValTok{5}\NormalTok{], }\ConstantTok{NA}\NormalTok{),}
    \StringTok{\textasciigrave{}}\AttributeTok{food\_density:low\_income}\StringTok{\textasciigrave{}} \OtherTok{=} \FunctionTok{ifelse}\NormalTok{(}\FunctionTok{length}\NormalTok{(estimates) }\SpecialCharTok{\textgreater{}=} \DecValTok{6}\NormalTok{, estimates[}\DecValTok{6}\NormalTok{], }\ConstantTok{NA}\NormalTok{),}
    \AttributeTok{R\_squared =} \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%.3f"}\NormalTok{, model\_summary}\SpecialCharTok{$}\NormalTok{r.squared),}
    \AttributeTok{F\_statistic =} \FunctionTok{ifelse}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(model\_summary}\SpecialCharTok{$}\NormalTok{fstatistic), }\FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%.1f"}\NormalTok{, model\_summary}\SpecialCharTok{$}\NormalTok{fstatistic[}\DecValTok{1}\NormalTok{]), }\ConstantTok{NA}\NormalTok{),}
    \AttributeTok{Observations =} \FunctionTok{length}\NormalTok{(model}\SpecialCharTok{$}\NormalTok{fitted.values),}
    \AttributeTok{stringsAsFactors =} \ConstantTok{FALSE}
\NormalTok{  )}
\NormalTok{\}))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Generate the summary table using kable with adjustments for width}
\FunctionTok{kable}\NormalTok{(}
\NormalTok{  cluster\_summary\_table,}
  \AttributeTok{format =} \StringTok{"latex"}\NormalTok{,}
  \AttributeTok{col.names =} \FunctionTok{c}\NormalTok{(}\StringTok{"Cluster"}\NormalTok{, }\StringTok{"(Intercept)"}\NormalTok{, }\StringTok{"Food Density"}\NormalTok{, }\StringTok{"Pop Density"}\NormalTok{, }
                \StringTok{"Avg HH Size"}\NormalTok{, }\StringTok{"Low Income"}\NormalTok{, }\StringTok{"Food Dens:Low Inc"}\NormalTok{,}
                \StringTok{"R\^{}2"}\NormalTok{, }\StringTok{"F Stat"}\NormalTok{, }\StringTok{"Obs"}\NormalTok{),}
  \AttributeTok{caption =} \StringTok{"Robustness Check: Model Results for Each Cluster"}\NormalTok{,}
  \AttributeTok{align =} \StringTok{"lcccccccc"}\NormalTok{,}
  \AttributeTok{booktabs =} \ConstantTok{TRUE}\NormalTok{,}
  \AttributeTok{escape =} \ConstantTok{FALSE}
\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{kable\_styling}\NormalTok{(}\AttributeTok{latex\_options =} \FunctionTok{c}\NormalTok{(}\StringTok{"hold\_position"}\NormalTok{, }\StringTok{"striped"}\NormalTok{, }\StringTok{"scale\_down"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{add\_header\_above}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{" "} \OtherTok{=} \DecValTok{1}\NormalTok{, }\StringTok{"Cluster{-}wise Model Summary"} \OtherTok{=} \DecValTok{9}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{footnote}\NormalTok{(}\AttributeTok{general =} \StringTok{"* p \textless{} 0.1; ** p \textless{} 0.05; *** p \textless{} 0.01"}\NormalTok{, }
           \AttributeTok{general\_title =} \StringTok{"Note:"}\NormalTok{, }
           \AttributeTok{footnote\_as\_chunk =} \ConstantTok{TRUE}\NormalTok{, }
           \AttributeTok{escape =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{table}[!h]
\centering
\caption{\label{tab:unnamed-chunk-17}Robustness Check: Model Results for Each Cluster}
\centering
\resizebox{\ifdim\width>\linewidth\linewidth\else\width\fi}{!}{
\begin{tabular}[t]{lccccccccl}
\toprule
\multicolumn{1}{c}{ } & \multicolumn{9}{c}{Cluster-wise Model Summary} \\
\cmidrule(l{3pt}r{3pt}){2-10}
Cluster & (Intercept) & Food Density & Pop Density & Avg HH Size & Low Income & Food Dens:Low Inc & R^2 & F Stat & Obs\\
\midrule
\cellcolor{gray!10}{Cluster 1} & \cellcolor{gray!10}{819.960 (17.592)***} & \cellcolor{gray!10}{0.665 (0.269)**} & \cellcolor{gray!10}{0.027 (0.001)***} & \cellcolor{gray!10}{-256.874 (6.370)***} & \cellcolor{gray!10}{-12.819 (6.522)**} & \cellcolor{gray!10}{-0.265 (0.363)} & \cellcolor{gray!10}{0.252} & \cellcolor{gray!10}{1068.5} & \cellcolor{gray!10}{15898}\\
Cluster 2 & 3079.475 (95.768)*** & -7.841 (5.525) & 0.026 (0.001)*** & -1396.640 (50.163)*** & 927.569 (31.691)*** & 16.712 (5.552)*** & 0.193 & 787.4 & 16451\\
\cellcolor{gray!10}{Cluster 3} & \cellcolor{gray!10}{236.881 (7.746)***} & \cellcolor{gray!10}{0.994 (0.295)***} & \cellcolor{gray!10}{0.016 (0.000)***} & \cellcolor{gray!10}{-51.092 (2.627)***} & \cellcolor{gray!10}{5.528 (2.231)**} & \cellcolor{gray!10}{-2.823 (0.427)***} & \cellcolor{gray!10}{0.385} & \cellcolor{gray!10}{2297.6} & \cellcolor{gray!10}{18354}\\
Cluster 4 & 66.636 (4.931)*** & 5.133 (0.428)*** & 0.012 (0.000)*** & -13.752 (1.908)*** & 36.705 (2.923)*** & -0.523 (0.608) & 0.200 & 568.0 & 11347\\
\bottomrule
\multicolumn{10}{l}{\rule{0pt}{1em}\textit{Note:} * p < 0.1; ** p < 0.05; *** p < 0.01}\\
\end{tabular}}
\end{table}

\end{document}
